# プロダクト要求定義書

## アプリケーションの目的

Dragons Counter（Dra Vincit）は、中日ドラゴンズファンが観戦した試合を記録・管理し、観戦履歴や成績を振り返ることができるWebアプリケーションである。

## ターゲットユーザーと課題・ニーズ

### ターゲットユーザー

- 中日ドラゴンズの試合を現地観戦するファン

### 課題

- 観戦した試合の記録が散逸し、振り返りが困難
- 観戦試合の勝率や傾向を把握する手段がない

### ニーズ

- 観戦試合をかんたんに記録できること
- 勝率や観戦数などの統計情報を確認できること
- 過去の観戦記録を一覧で振り返れること

## 主要な機能

### 1. 試合記録管理

- 試合結果のスクレイピングによる自動取得・登録
- 試合記録の一覧表示
- 試合記録の削除（論理削除）
- 試合の一括登録

### 2. 観戦統計

- 観戦試合数の集計
- 勝利数・敗北数・引き分け数の集計
- 勝率の算出

### 3. ユーザー認証（基盤構築中）

- メールアドレス・パスワードによるユーザー登録
- 承認制のアカウント管理（PENDING → APPROVED → ログイン可能）
- JWT認証

## 機能要件

### 試合記録

| 要件ID | 要件 | 詳細 |
|--------|------|------|
| FR-001 | 試合結果の自動取得 | 日付を指定してドラゴンズの試合結果をスクレイピングで取得する |
| FR-002 | 試合の一括登録 | スクレイピング結果を含む試合データを一括登録する。同一日付の試合は重複スキップする |
| FR-003 | 試合一覧表示 | 登録済み全試合を一覧で表示する。試合日、対戦相手、スコア、勝敗、スタジアム、メモを含む |
| FR-004 | 試合削除 | 指定した試合記録を論理削除する |
| FR-005 | 観戦統計表示 | 観戦数、勝利数、敗北数、引き分け数、勝率を表示する |

### ユーザー認証

| 要件ID | 要件 | 詳細 |
|--------|------|------|
| FR-101 | ユーザー登録 | メールアドレスとパスワードで新規ユーザーを登録する。登録直後はPENDINGステータス |
| FR-102 | ログイン制御 | APPROVEDステータスのユーザーのみログイン可能とする |
| FR-103 | パスワード管理 | パスワードはbcryptでハッシュ化して保存する |

## 非機能要件

| 要件ID | カテゴリ | 要件 |
|--------|----------|------|
| NFR-001 | アーキテクチャ | バックエンドはドメイン駆動設計（DDD）を採用する |
| NFR-002 | アーキテクチャ | CQRSパターンでCommand/Queryを分離する |
| NFR-003 | セキュリティ | HTTPS通信を必須とする |
| NFR-004 | セキュリティ | CORS設定により許可されたオリジンのみアクセスを許可する |
| NFR-005 | セキュリティ | パスワードはbcryptでハッシュ化する |
| NFR-006 | 可用性 | ヘルスチェックエンドポイント（`/health`）を提供する |
| NFR-007 | 運用 | GitHub Actions によるCI/CDパイプラインを構築する |
| NFR-008 | 運用 | AWS CodeDeployによるデプロイを実施する |
| NFR-009 | インフラ | AWS上に構築する（EC2 + ALB + RDS） |
| NFR-010 | データ | 試合削除は論理削除（`deletedAt`フィールド）で実装する |
| NFR-011 | テスト | テストコードはDockerコンテナ内で実行する |
